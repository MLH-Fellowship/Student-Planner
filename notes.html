<html>
    <head>
        <meta charset="utf-8">
        <title>Student Planner</title>
        <style media="screen">
            body {
                display: flex;
                min-height: 100vh;
                width: 100%;
                padding: 0;
                margin: 0;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }

            #uploader {
                -webkit-appearance: none;
                appearance: none;
                width: 50%;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use  
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-storage.js"></script>

        <script>
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            var config = {
                apiKey: "AIzaSyD2kPuOnf4st2efOTNn2R1e92wy2rq2jWg",
                authDomain: "student-planner-d43e2.firebaseapp.com",
                databaseURL: "https://student-planner-d43e2.firebaseio.com",
                projectId: "student-planner-d43e2",
                storageBucket: "student-planner-d43e2.appspot.com", 
                messagingSenderId: "327005986193",
                appId: "1:327005986193:web:490cb8f00284781fd3ce30",
                measurementId: "G-KLRT1S5PJG"
            };
            // Initialize Firebase
            firebase.initializeApp(config);
            firebase.analytics();
        </script>

        <!-- Textbox for folder name -->
        <div style="display:flex; flex-direction:row; justify-content:center; align-items:center">
            <label for="folder">Folder:  </label>
            <input type="text" id="folder"/>
        </div>

        <br>
        <br>

        <!-- Progress bar and button for file upload -->
        <progress value="0" max="100" id="uploader">0%</progress>
        <input type="file" value="upload" id="fileButton" />

        <br>
        <br>

        <!-- Textbox for file name to download -->
        <div style="display:flex; flex-direction:row; justify-content:center; align-items:center">
            <label for="fileName">Download file:  </label>
            <input type="text" id="fileName"/>
            <button onclick="download() ">Submit</button>
        </div>

        <script>
            /** Create new bucket folders */
            function getFolderName() {
                var folderName = document.getElementById("folder").value + "/";
                return folderName;
            }

            /** Upload documents */

            // Get elements
            var uploader = document.getElementById('uploader');
            var fileButton = document.getElementById('fileButton');

            // Listen for file selection
            fileButton.addEventListener('change', function(e) {
                // Get file
                var file = e.target.files[0];

                // Create a storage ref
                var storageRef = firebase.storage().ref(getFolderName() + file.name);

                // Upload file
                var task = storageRef.put(file);

                // Update progress bar
                task.on('state_changed', 

                    function progress(snapshot) {
                        var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        uploader.value = percentage;
                    }, 

                    function error(err) {
                        switch (error.code) {
                            case "storage/unauthorized" :
                                break;
                            case "storage_canceled":
                                alert('You have canceled this upload');
                                break;
                            case "storage/unauthenticated":
                                alert("Please sign in!");
                                break;
                            case "storage/object-not-found":
                                alert("This file or folder doesn't exist!");
                                break;
                            case "storage/unknown":
                                alert("An unknown error has occurred. Please try again");
                                break;
                        };
                        window.location.reload();
                    },

                    function() {
                        window.alert("Upload successful!");
                        window.location.reload();
                    }
                )
            });

            /** Download files */
            function download() {

                // Get elements
                var fileName = document.getElementById("fileName").value;
                var path = getFolderName() + fileName;
                var fileRef = firebase.storage().ref(path);

                // Download data
                fileRef.getDownloadURL().then(function(url) {
                    window.open(url, "_blank");
                }).catch(function(error) {
                    switch (error.code) {
                        case "storage/object-not-found":
                            alert("File doesn't exist!");
                            break;
                        case "storage/unauthenticated":
                            alert("Please sign in!");
                            break;
                        case "storage/unknown":
                            alert("An unknown error has occurred. Please try again");
                            break;
                    };
                    window.location.reload();
                });
            }
        </script>
    </body>
</html>